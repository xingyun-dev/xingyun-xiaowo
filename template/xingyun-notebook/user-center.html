{% extends "/xingyun-notebook/base.html" %}   {#将当前页面继承至base.html母版#}
{% block content %}
<style>
    @media (max-width: 1000px ){
        .liulan{
            display: none;
        }
          .pinglun{
            display: none;
        }
            .caozuo{
            display: none;
        }
    }
</style>
<div class="container" style="margin-top: 20px;">
    <div class="row">

        <!-- 中部区域布局 -->
        <div class="container" style="margin-top: 10px;">
            <div class="row">
                <div class="col-sm-2 col-12" style="padding: 0px 10px; ">
                    <div class="col-12 admin-side" style="height: 320px">
                        <!-- 绘制左侧菜单栏并添加正确的超链接 -->
                        <ul>
                            <li><a href="/ucenter" style="align-items:center;"><span></span>&nbsp;&nbsp;我的收藏</a>
                            </li>
                            <li><a id="newArticleBtn" href="/mdpost"><span></span>&nbsp;&nbsp;新建文章</a></li>
                            <li><a href="/ucenter/article"><span></span>&nbsp;&nbsp;我的文章</a></li>
                            <li><a href="/ucenter/drafted"><span></span>&nbsp;&nbsp;我的草稿</a></li>
                            <li><a href="/ucenter/tools"><span></span>&nbsp;&nbsp;我的工具</a></li>
                            <li><a href="/person/{{session.userid}}"><span></span>&nbsp;&nbsp;个人信息</a></li>

                        </ul>
                    </div>
                </div>
                <div class="col-sm-10 col-12" style="padding: 0px 10px">
                    <div class="col-12 admin-main">
                        <!--搜索栏-->
                        <div class="col-12 search-bar row">
                            <div class="col-2">
                                <select id="category" class="form-control" onchange="doSearch()">
                                    <option value="" style="display: none">请选择分类</option>
                                    <option value="all">全部分类</option>
                                    {% for key, value in article_type.items() %}
                                    <option value="{{ key }}">{{ value }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-3">
                                <input type="text" class="form-control" id="keyword" placeholder="搜索文章"
                                       onkeyup="doSearchBykeyword(event)">
                            </div>
                            <div class="col-2" style="text-align:left;">
                                <button type="button" class="btn btn-dark" onclick="doSearchBykeyword(null)">搜索
                                </button>
                            </div>


                            <div class="col-3">
                                <input type="text" class="form-control" id="keyeditor" placeholder="查询作者"
                                       onkeyup="doSearchBymingzi(event)">
                            </div>
                            <div class="col-2" style="text-align:left;">
                                <button type="button" class="btn btn-danger" onclick="doSearchBymingzi(null)">查询
                                </button>
                            </div>

                        </div>

                        <div class="col-12" style="padding: 10px;">
                            <table class="table col-12">
                                <thead style="font-weight: bold">
                                <tr>
                                    <td width="8%" align="center" >编号</td>
                                    <td width="30%">标题</td>
                                    <td width="20%" align="center">作者</td>
                                    <td width="14%" align="center">类型</td>
                                    <td width="7%" align="center" class="liulan">浏览</td>
                                    <td width="7%" align="center" class="pinglun">评论</td>
                                    <td width="14%" align="center" class="caozuo">操作</td>
                                </tr>
                                </thead>
                                <tbody>

                                {%for favorite,article,nickname in result%}
                                <tr>
                                    <td align="center">{{loop.index }}</td>
                                    <td>
                                        <a href="/notebook/{{is_markdown(article.articleid)}}/{{article.articleid}}">
                                            {{article.headline}}
                                        </a>
                                    </td>
                                    <td align="center">{{nickname}}</td>

                                    <td align="center">{{article_type[article.category | string]}}</td>
                                    <td align="center" class="liulan">{{article.readcount}}</td>
                                    <td align="center" class="pinglun">{{article.replycount}}</td>
                                    <td align="center" class="caozuo">
                                        <button class="favorite_switch"
                                                onclick="switchFavorite(this,'{{favorite.favoriteid}}')"
                                                style="border: none;">

                                        </button>
                                    </td>
                                </tr>

                                {%endfor%}
                                </tbody>

                            </table>
                        </div>

                         <!-- 分页导航栏 -->
                        <div class="col-12 paginate">
                            {% if page==1%}
                            <!-- 如果是第1页，则上一页也是第1页，否则上一页为当前页-1 -->
                            <a href="/ucenter/1">上一页</a>&nbsp;&nbsp;
                            {% else %}
                            <a href="/ucenter/{{page-1}}">上一页</a>&nbsp;&nbsp;
                            {% endif %}

                            <!-- 根据总页数循环填充页码，并为其添加超链接进行导航 -->
                            {% for i in range(total) %}
                            <a href="/ucenter/{{i+1}}">{{i+1}}</a>&nbsp;&nbsp;
                            {% endfor %}

                            {% if page==total%}
                            <!-- 如果是最后一页，则下一页也是最后页，否则下一页为当前页+1 -->
                            <a href="/ucenter/{{total}}">下一页</a>
                            {% else %}
                            <a href="/ucenter/{{page+1}}">下一页</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- 对应的switchFavorite函数的代码 -->
        <script type="text/javascript">

            // 分类搜索
            function doSearch(event) {
                if (event != null && event.keyCode !== 13) {
                    return false;
                }
                var category = $.trim($("#category").val());
                if (category === "all") {  // 当选择项为"全部分类"时
                    location.href = "/ucenter";  // 跳转到 "/admin" 页面
                } else {
                    location.href = "/ucenter/type/" + category + "--1";  // 其他选项跳转到相应的链接地址
                }
            }

            // 关键字搜索
            function doSearchBykeyword(event) {
                if (event != null && event.keyCode != 13) {
                    return false;
                }

                var keyword = $.trim($("#keyword").val());
                if (keyword.length == 0 || keyword.length > 10 || keyword.indexOf('%') >= 0) {
                    bootbox.alert({'title': '错误提示！', 'message': "您输入的关键字不合理"});
                    $("#keyword").focus();
                    return false;
                }
                location.href = "/ucenter/search/" + keyword;

            }

            // 作者查询
            function doSearchBymingzi(event) {
                if (event != null && event.keyCode != 13) {
                    return false;
                }

                var keyword = $.trim($("#keyeditor").val());
                if (keyword.length == 0 || keyword.length > 10 || keyword.indexOf('%') >= 0) {
                    bootbox.alert({'title': '错误提示！', 'message': "您输入的查询名字未找到"});
                    $("#keyword").focus();
                    return false;
                }
                location.href = "/ucenter/search_mingzi/" + keyword;

            }


            function switchFavorite(obj, favoriteid) {
                $.get('/user/favorite/' + favoriteid, function (data) {
                    if (data == '1') {
                        $(obj).html('<span class=" btn btn-success" style="font-size: 15px">继续收藏</span>');

                    } else {
                        $(obj).html('<span class=" btn btn-danger" style="font-size: 15px">取消收藏</span>');


                    }
                });

            }

            $(document).ready(function () {
                // 在页面加载完成后执行的代码
                $('.favorite_switch').each(function () {
                    var onclick = $(this).attr('onclick');
                    var favoriteid = onclick.substring(onclick.indexOf('(') + 1, onclick.indexOf(')'));
                    switchFavorite(this, favoriteid);
                });
            });

            $('#newArticleBtn').click(function () {
                // 清空本地存储的草稿内容
                localStorage.removeItem('draftHeadline');
                localStorage.removeItem('draftMarkdownContent');
                // localStorage.removeItem('draftHtmlContent');

            });
        </script>


    </div>
</div>
{% endblock %}